---
title: "ğŸ¦Š chap10. ëŒë‹¤ë¥¼ ì´ìš©í•œ ë„ë©”ì¸ ì „ìš© ì–¸ì–´"
author: gengminy
date: 2023-12-17 12:00:00 +09:00
categories: [ëª¨ë˜ ìë°” ì¸ ì•¡ì…˜, "chap10. ëŒë‹¤ë¥¼ ì´ìš©í•œ ë„ë©”ì¸ ì „ìš© ì–¸ì–´"]
tags: [ëª¨ë˜ ìë°” ì¸ ì•¡ì…˜, JAVA, 9ì£¼ì°¨, ë…¸ê²½ë¯¼]
render_with_liquid: false
math: true
---

# chap10. ëŒë‹¤ë¥¼ ì´ìš©í•œ ë„ë©”ì¸ ì „ìš© ì–¸ì–´

# 10.1 ë„ë©”ì¸ ì „ìš© ì–¸ì–´

DSLì€ íŠ¹ì • ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ê³  ë§Œë“  ì–¸ì–´ì´ë‹¤.

DSLì´ë€ íŠ¹ì • ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ì„ ì¸í„°í˜ì´ìŠ¤ë¡œ ë§Œë“  APIë¼ê³  ìƒê°í•  ìˆ˜ ìˆë‹¤.

- ì½”ë“œì˜ ì˜ë„ê°€ ëª…í™•íˆ ì „ë‹¬ë˜ì–´ì•¼ í•˜ë©° í”„ë¡œê·¸ë˜ë¨¸ê°€ ì•„ë‹Œ ì‚¬ëŒë„ ì´í•´í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
- ê°€ë…ì„±ì€ ìœ ì§€ë³´ìˆ˜ì˜ í•µì‹¬ì´ë‹¤

### 10.1.1 DSLì˜ ì¥ì ê³¼ ë‹¨ì 

- ì¥ì 
  - ê°„ê²°í•¨: APIëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìº¡ìŠí™”í•˜ì—¬ ë°˜ë³µì„ í”¼í•˜ê³  ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ í•œë‹¤
  - ê°€ë…ì„±: ë¹„ ë„ë©”ì¸ ì „ë¬¸ê°€ë„ ì½”ë“œë¥¼ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆë‹¤
  - ìœ ì§€ë³´ìˆ˜: ì˜ ì„¤ê³„ëœ DSLë¡œ êµ¬í˜„í•œ ì½”ë“œëŠ” ì‰½ê²Œ ìœ ì§€ë³´ìˆ˜í•˜ê³  ë°”ê¿€ ìˆ˜ ìˆë‹¤
  - ë†’ì€ ìˆ˜ì¤€ì˜ ì¶”ìƒí™”: ì¶”ìƒí™” ìˆ˜ì¤€ì—ì„œ ë™ì‘í•˜ë¯€ë¡œ ë„ë©”ì¸ê³¼ ì§ì ‘ì ìœ¼ë¡œ ê´€ë ¨ë˜ì§€ ì•Šì€ ì„¸ë¶€ì‚¬í•­ì„ ìˆ¨ê¸´ë‹¤
  - ì§‘ì¤‘: í”„ë¡œê·¸ë˜ë¨¸ê°€ íŠ¹ì • ì½”ë“œì— ì§‘ì¤‘í•  ìˆ˜ ìˆê³  ê²°ê³¼ì ìœ¼ë¡œ ìƒì‚°ì„±ì´ ì¢‹ì•„ì§„ë‹¤
  - ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬: ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¸í”„ë¼ êµ¬ì¡°ì™€ ê´€ë ¨ëœ ë¬¸ì œì™€ ë…ë¦½ì ìœ¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ë ¨ëœ ì½”ë“œì— ì§‘ì¤‘í•˜ê¸° ìš©ì´í•˜ë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ìš´ ì½”ë“œë¥¼ êµ¬í˜„í•œë‹¤.
- ë‹¨ì 
  - ì„¤ê³„ì˜ ì–´ë ¤ì›€: ê°„ê²°í•˜ê²Œ ì œí•œì ì¸ ì–¸ì–´ì— ë„ë©”ì¸ ì§€ì‹ì„ ë‹´ëŠ” ê²ƒì€ ì‰½ì§€ ì•Šë‹¤
  - ê°œë°œ ë¹„ìš©: ì´ˆê¸° í”„ë¡œì íŠ¸ì— ë§ì€ ë¹„ìš©ê³¼ ì‹œê°„ì´ ì†Œëª¨ë˜ë©° ìœ ì§€ë³´ìˆ˜ì™€ ë³€ê²½ì€ ë¶€ë‹´ì„ ì£¼ëŠ” ìš”ì†Œì´ë‹¤
  - ì¶”ê°€ ìš°íšŒ ê³„ì¸µ: DSLì€ ì¶”ê°€ ê³„ì¸µìœ¼ë¡œ ë„ë©”ì¸ ëª¨ë¸ì„ ê°ì‹¸ë©° ê³„ì¸µì„ ìµœëŒ€í•œ ì‘ê²Œ ë§Œë“¤ì–´ ì„±ëŠ¥ ë¬¸ì œë¥¼ íšŒí”¼í•´ì•¼ í•œë‹¤.
  - ìƒˆë¡œ ë°°ì›Œì•¼í•˜ëŠ” ì–¸ì–´: íŒ€ì´ ë°°ì›Œì•¼í•˜ëŠ” ì–¸ì–´ê°€ í•œ ê°œ ë” ëŠ˜ì–´ë‚œë‹¤ëŠ” ë¶€ë‹´ì´ ìˆë‹¤
  - í˜¸ìŠ¤íŒ… ì–¸ì–´ í•œê³„: ì¥í™©í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“  DSLì€ ì„±ê°€ì‹  ë¬¸ë²•ì˜ ì œì•½ì„ ë°›ê³  ì½ê¸°ê°€ ì–´ë ¤ì›Œì§„ë‹¤.

### 10.1.2 JVMì—ì„œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ DSL í•´ê²°ì±…

### ë‚´ë¶€ DSL

ìë°” ê¸°ì¤€ìœ¼ë¡œ ìë°”ë¡œ êµ¬í˜„í•œ DSLì„ ì˜ë¯¸í•œë‹¤.

ì¥ì 

- ê¸°ì¡´ ìë°” ì–¸ì–´ë¥¼ ì´ìš©í•˜ë©´ ì™¸ë¶€ DSLì— ë¹„í•´ ìƒˆë¡œìš´ ê¸°ìˆ ì— ëŒ€í•œ ë…¸ë ¥ì´ í˜„ì €í•˜ê²Œ ì¤„ì–´ë“ ë‹¤.
- ë‹¤ë¥¸ ì–¸ì–´ì˜ ì»´íŒŒì¼ëŸ¬ë¥¼ ì´ìš©í•˜ê±°ë‚˜ ì™¸ë¶€ DSL ë„êµ¬ì— ëŒ€í•œ ì¶”ê°€ ë¹„ìš©ì´ ë“¤ì§€ ì•ŠëŠ”ë‹¤
- ìƒˆë¡œìš´ ì–¸ì–´ë¥¼ ë°°ìš°ì§€ ì•Šì•„ë„ ëœë‹¤
- ê¸°ì¡´ ìë°” IDEì˜ ìë™ ì™„ì„±, ìë™ ë¦¬íŒ©í„°ë§ ê°™ì€ ê¸°ëŠ¥ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ì¶”ê°€ DSLì„ ê°œë°œí•´ì•¼ í•˜ëŠ” ìƒí™©ì— ì‰½ê²Œ í•©ì¹  ìˆ˜ ìˆë‹¤.

### ë‹¤ì¤‘ DSL

JVMì—ì„œ ì‹¤í–‰ë˜ëŠ” ì–¸ì–´ëŠ” 100ê°œê°€ ë„˜ëŠ”ë‹¤.

ë‹¨ì 

- ìƒˆë¡œìš´ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ë°°ìš°ê±°ë‚˜ ì´ë¯¸ í•´ë‹¹ ê¸°ìˆ ì„ ê°€ì§€ê³  ìˆì–´ì•¼ í•œë‹¤.
- ì—¬ëŸ¬ ì»´íŒŒì¼ëŸ¬ë¡œ ì†ŒìŠ¤ë¥¼ ë¹Œë“œí•˜ë„ë¡ ë¹Œë“œ ê³¼ì •ì„ ê°œì„ í•´ì•¼ í•œë‹¤.
- ìë°”ì™€ í˜¸í™˜ì„±ì´ ì™„ë²½í•˜ì§€ ì•Šì•„ ì„±ëŠ¥ ì†ì‹¤ì´ ë°œìƒí•  ìˆ˜ë„ ìˆë‹¤.

### ì™¸ë¶€ DSL

ìì‹ ë§Œì˜ ë¬¸ë²•ê³¼ êµ¬ë¬¸ìœ¼ë¡œ ìƒˆ ì–¸ì–´ë¥¼ ì„¤ê³„í•´ì•¼ í•œë‹¤.

ì¥ì ì€ ë¬´í•œí•œ ìœ ì—°ì„±ì„ ì œê³µí•œë‹¤ëŠ” ê²ƒì´ì§€ë§Œ, ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œì˜ ë¶„ë¦¬ë¡œ ì¸ê³µ ê³„ì¸µì´ ìƒê¸°ê¸° ë•Œë¬¸ì— ì–‘ë‚ ì˜ ê²€ê³¼ ê°™ë‹¤.

# 10.2 ìµœì‹  ìë°” APIì˜ ì‘ì€ DSL

- ë„¤ì´í‹°ë¸Œ ìë°” API

ìë°” 8ì—ì„œ ëŒë‹¤ì™€ ë©”ì„œë“œ ì°¸ì¡°ë¥¼ í†µí•´ ì¬ì‚¬ìš©ì„±ê³¼ ë©”ì„œë“œ ê²°í•©ë„ê°€ ë†’ì•„ì¡Œë‹¤.

### 10.2.1 ìŠ¤íŠ¸ë¦¼ APIëŠ” ì»¬ë ‰ì…˜ì„ ì¡°ì‘í•˜ëŠ” DSL

Stream ì¸í„°í˜ì´ìŠ¤ëŠ” ë„¤ì´í‹°ë¸Œ ìë°” APIì— ì‘ì€ ë‚´ë¶€ DSLì„ ì ìš©í•œ ì¢‹ì€ ì˜ˆì‹œì´ë‹¤.

```java
List<String> errors = new ArrayList<>();
int errorCount = 0;
BufferedReader bufferedReader
	= new BufferedReader(new FileReader(fileName));
String line = bufferedReader.readLine();
while (errorCount < 40 && line != null) {
	if (line.startWith("ERROR")) {
		errors.add(line);
		errorCount++;
	}
	line = bufferedReader.readLine();
}
```

ì½”ë“œê°€ ì¥í™©ì— ì˜ë„ë¥¼ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì–´ë ¤ìš´ ì½”ë“œì´ë‹¤.

ì´ë¥¼ Stream ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ í•¨ìˆ˜í˜•ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ì‰½ê³  ê°„ê²°í•˜ê²Œ ì½”ë“œë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```java
List<String> errors = Files.lines(Paths.get(fileName)
													 .filter(line -> line.startsWith("ERROR"))
													 .limit(40)
													 .collect(toList());
```

ìŠ¤íŠ¸ë¦¼ APIì˜ í”Œë£¨ì–¸íŠ¸ í˜•ì‹ì€ ì˜ ì„¤ê³„ëœ DSLì˜ íŠ¹ì§•ì´ë‹¤.

### 10.2.2 ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” DSLì¸ Collectors

Collector ì¸í„°í˜ì´ìŠ¤ëŠ” ë°ì´í„° ìˆ˜ì§‘ì„ ìˆ˜í–‰í•˜ëŠ” DSLë¡œ ê°„ì£¼í•  ìˆ˜ ìˆë‹¤.

ê·¸ë£¹í™” í‰ê°€ ìˆœì„œê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆëŠ”ë° ì´ëŠ” GroupingBuilder ë¥¼ ë§Œë“¤ì–´ ì‘ì—…ì„ ìœ„ì„í•˜ë©´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

# 10.3 ìë°”ë¡œ DSLì„ ë§Œë“œëŠ” íŒ¨í„´ê³¼ ê¸°ë²•

### 10.3.1 ë©”ì„œë“œ ì²´ì¸

DSLì—ì„œ ê°€ì¥ í”í•œ ë°©ì‹ì´ë‹¤. ì´ë¥¼ ì´ìš©í•˜ë©´ í•œ ê°œì˜ ë©”ì„œë“œ í˜¸ì¶œ ì²´ì¸ìœ¼ë¡œ ê±°ë˜ ì£¼ë¬¸ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```java
Order order = forCustomer("BigBank")
			.buy(80)
			.stock("IBM")
			.on("NYSE")
			.at(125.00)
			.sell(50)
			.stock("GOOGLE")
			.on("NASDAQ")
			.at(375.00)
			.end();
```

ì´ë¥¼ ìœ„í•´ í”Œë£¨ì–¸íŠ¸ APIë¡œ ë„ë©”ì¸ ê°ì²´ë¥¼ ë§Œë“œëŠ” ëª‡ ê°œì˜ ë¹Œë”ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.

```java
public class MethodChainingOrderBuilder {

		public final Order order = new Order();

		private MethodChainingOrderBuilder(String customer) {
				order.setCustomer(customer);
		}

		public static MethodChainingOrderBuilder forCustomer(String customer) {
				return new MethodChainingOrderBuilder(customer);
		}

		public TradeBuilder buy(int quantity) {
				return new TradeBuilder(this, Trade.Type.BUY, quantity);
		}

		public TradeBuilder sell(int quantity) {
				return new TradeBuilder(this, Trade.Type.SELL, quantity);
		}

		public MethodChainingOrderBuilder addTrade(Trade trade) {
				order.addTrade(trade);
				return this;
		}

		public Order end() {
				return order;
		}
}
```

buy, sell ë©”ì„œë“œëŠ” ë‹¤ë¥¸ ì£¼ë¬¸ì„ ë§Œë“¤ì–´ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ìì‹ ì„ ë§Œë“¤ì–´ ë°˜í™˜í•œë‹¤

```java
public class TradeBuilder {
		private final MethodChainingOrderBuilder builder;
		public final Trade trade = new Trade();

		private TradeBuilder(MethodChainingOrderBuilder builder,
												 Trade.Type type, int quantity) {
				this.builder = builder;
				trade.setType(type);
				trade.setQuantity(quantity);
		}

		public StockBuilder stock(String symbol) {
				return new StockBuilder(builder, trade, symbol);
		}
}
```

Stock í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” TradeBuilder ì˜ ê³µê°œ ë©”ì„œë“œë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.

```java
public class StockBuilder {
		private final MethodChainingOrderBuilder builder;
		private final Trade trade;
		private final Stock stock = new Stock();

		private StockBuilder(MethodChainingOrderBuilder builder,
												 Trade trade, String symbol) {
				this.builder = builder;
				this.trade = trade;
				stock.setSymbol(symbol);
		}

		public TradeBuilderWithStock on(String market) {
				stock.setMarket(market);
				trade.setStock(stock);
				return new TradeBuilderWithStock(builder, trade);
		}
}
```

ì£¼ì‹ ì‹œì¥ì„ ì§€ì •í•˜ê³  ê±°ë˜ì— ì£¼ì‹ì„ ì¶”ê°€í•˜ê³  ìµœì¢… ë¹Œë”ë¥¼ ë°˜í™˜í•˜ëŠ” on ë©”ì„œë“œ í•œ ê°œë¥¼ ì •ì˜í•œë‹¤.

```java
public class TradeBuilderWithStock {
		private final MethodChainingOrderBuilder builder;
		private final Trade trade;

		public TradeBuilderWithStock(MethodChainingOrderBuilder builder, Trade trade) {
				this.builder = builder;
				this.trade = trade;
		}

		public MethodChainingOrderBuilder at(double price) {
				trade.setPrice(price);
				return builder.addTrade(trade);
		}
}
```

ì‚¬ìš©ìê°€ ë¯¸ë¦¬ ì§€ì •ëœ ì ˆì°¨ì— ë”°ë¼ í”Œë£¨ì–¸íŠ¸ APIì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë„ë¡ ê°•ì œí•˜ì—¬ ê¸°ì¡´ ê±°ë˜ë¥¼ ì˜¬ë°”ë¡œ ì„¤ì •í•˜ê²Œ ëœë‹¤.

ë‹¤ë§Œ ìƒìœ„ ìˆ˜ì¤€ì˜ ë¹Œë”ë¥¼ í•˜ìœ„ ìˆ˜ì¤€ì˜ ë¹Œë”ì™€ ì—°ê²°í•  ì ‘ì°© ë§ì€ ì½”ë“œê°€ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì´ ë‹¨ì ì´ë‹¤.

### 10.3.2 ì¤‘ì²©ëœ í•¨ìˆ˜ ì´ìš©

ë‹¤ë¦„ í•¨ìˆ˜ ì•ˆì— í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë„ë©”ì¸ ëª¨ë¸ì„ ë§Œë“œëŠ” DSL íŒ¨í„´ì´ë‹¤.

```java
Order oder = order("BigBank",
									buy(80, stock("IBM", on("NYSE")), at(125.00)),
									sell(50, stock("GOOGLE", on("NASDAQ")), at(375.00))
								);
```

```java
public class NestedFunctionOrderBuilder {

		public static Order order(String customer, Trade... trades) {
				Order order = new Order()
				order.setCustomer(customer);
				Stream.of(trades).forEach(order::addTrade); // ì£¼ë¬¸ì— ëª¨ë“  ê±°ë˜ ì¶”ê°€
				return order;
		}

		public static Trade buy(int quantity, Stock stock, double price) {
				return buildTrade(quantity, stock, price, Trade.Type.BUY);
		}

		public static Trade sell(int quantity, Stock stock, double price) {
				return buildTrade(quantity, stock, price, Trade.Type.SELL);
		}

		private static Trade buildTrade(int quantity, Stock stock, double price, Trade.Type buy) {
				Trade trade = new Trade();
				trade.setQuantity(quantity);
				trade.setType(buy);
				trade.setStock(stock);
				trade.setPrice(price);
				return trade;
		}

		public static double at(double price) {
				return price;
		}

		public static Stock stock(String symbol, String market) {
				Stock stock = new Stock();
				stock.setSymbol(symbol);
				stock.setMarket(market);
				return stock;
		}

		public static String on(String market) {
				return market;
		}
}
```

ë©”ì„œë“œ ì²´ì´ë‹ì— ë¹„í•´ êµ¬í˜„ì´ ê°„ë‹¨í•˜ë‹¤.

í•˜ì§€ë§Œ ê²°ê³¼ DSLì— ë” ë§ì€ ê´„í˜¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê³  ì¸ìˆ˜ ëª©ë¡ì„ ì •ì  ë©”ì„œë“œì— ë„˜ê²¨ì¤˜ì•¼ í•œë‹¤ëŠ” ì œì•½ì´ ìˆë‹¤.

ì¸ìˆ˜ ìƒëµì— ëŒ€í•œ ê°€ëŠ¥ì„±ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì—¬ëŸ¬ ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.

### 10.3.3 ëŒë‹¤ í‘œí˜„ì‹ì„ ì´ìš©í•œ í•¨ìˆ˜ ì‹œí€€ì‹±

```java
public class LambdaOrderBuilder {
		private Order order = new Order();

		public static Order order(Consumer<LambdaOrderBuilder> consumer) {
				LambdaOrderBuilder builder = new LambdaOrderBulider();
				consumer.accept(builder)
				return builder.order;
		}

		public void forCustomer(String customer) {
				order.setCustomer(customer);
		}

		public void buy(Consumer<TradeBuilder> consumer) {
				trade(consumer, Trade.Type.BUY);
		}

		public void sell(Consumer<TradeBuilder> consumer) {
				trade(consumer, Trade.Type.SELL);
		}

		private void trade(Consumer<TradeBuilder> consumer, Trade.Type type) {
				TradeBuilder builder = new TradeBulder();
				builder.trade.setType(type);
				consumer.accept(builder);
				order.addTrade(builder.trade);
		}
}
```

buy sell ë©”ì„œë“œëŠ” ë‘ ê°œì˜ Consumer ëŒë‹¤ í‘œí˜„ì‹ì„ ë°›ê³ , ì´ë¥¼ ì‹¤í–‰í•˜ë©´ ê±°ë˜ê°€ ë§Œë“¤ì–´ì§„ë‹¤.

```java
public class TradeBuilder {
		private Trade trade = new Trade();

		public void quantity(int quantity) {
				trade.setQuantity(quantity);
		}

		public void price(double price) {
				trade.setPrice(price);
		}

		public void stock(Consumer<StockBuilder> consumer) {
				StockBuilder builder = new StockBuilder();
				consumer.accept(builder);
				trade.setStock(builder.stock);
		}
}
```

```java
public class StockBuilder {
		private Stock stock = new Stock();

		public void symbol(String symbol) {
				stock.setSymbol(symbol);
		}

		public void market(String market) {
				stock.setMarket(market);
		}
}
```

ë©”ì„œë“œ ì²´ì¸ íŒ¨í„´ì²˜ëŸ¼ í”Œë£¨ì–¸íŠ¸ ë°©ì‹ìœ¼ë¡œ ê±°ë˜ ì£¼ë¬¸ì„ ì •ì˜í•  ìˆ˜ ìˆê³ ,

ì¤‘ì²© í•¨ìˆ˜ í˜•ì‹ì²˜ëŸ¼ ë‹¤ì–‘í•œ ëŒë‹¤ í‘œí˜„ì‹ì˜ ì¤‘ì²© ìˆ˜ì¤€ê³¼ ë¹„ìŠ·í•˜ê²Œ ë„ë©”ì¸ ê°ì²´ì˜ ê³„ì¸µ êµ¬ì¡°ë¥¼ ìœ ì§€í•œë‹¤.

ë‹¤ë§Œ DSL ìì²´ê°€ ìë°” 8 ëŒë‹¤ í‘œí˜„ì‹ ë¬¸ë²•ì— ì˜í•œ ì¡ìŒì˜ ì˜í–¥ì„ ë°›ê²Œ ëœë‹¤.

### 10.3.4 ì¡°í•©í•˜ê¸°

```java
Order order =
		forCustomer("BigBank",
								buy(t -> t.quantity(80
													.stock("IBM") // ê±°ë˜ ê°ì²´ë¥¼ ë§Œë“œëŠ” ëŒë‹¤ í‘œí˜„ì‹ ë°”ë””ì˜ ë©”ì„œë“œ ì²´ì¸
													.on("NYSE")
													.at(125.00)),
								sell(t -> t.quantity(50)
													 .stock("GOOGLE")
													 .on("NASDAQ")
													 .at(125.00)) );
```

```java
public class MixedBuilder {

		public static Order forCustomer(String customer, TradeBuilder... builders) {
				Order order = new Order();
				order.setCustomer(customer);
				Stream.of(builders).forEach(b -> order.addTrade(b.trade));
				return order;
		}

		public static TradeBuilder buy(Consumer<TradeBuilder> consumer) {
				return buildTrade(consumer, Trade.Type.BUY);
		}

		public static TradeBuilder sell(Consumer<TradeBulder> consumer) {
				return buildTrade(consumer, Trade.Type.SELL);
		}

		private static TradeBuilder buildTrade(Consumer<TradeBuilder> consumer, Trade.Type type) {
				TradeBuilder builder = new TradeBuilder();
				builder.trade.setType(buy);
				consumer.accept(builder);
				return builder;
		}
}
```

```java
public class TradeBuilder {
		private Trade trade = new Trade();

		public TradeBuilder quantity(int quantity) {
				trade.setQuantity(quantity);
				return this;
		}

		public TradeBuilder at(double price) {
				trade.setPrice(price);
				return this;
		}

		public StockBuilder stock(String symbol) {
				return StockBuilder(this, trade, symbol);
		}
}

public class StockBuilder {
		private final TradeBuilder builder;
		private final Trade trade;
		private final Stock stock = new Stock();

		private StockBuilder(TradeBuilder builder, Trade trade, String symbol){
				this.builder = builder;
				this.trade = trade;
				stock.setSymbol(symbol);
		}

		public TradeBuilder on(String market) {
				stock.setMarket(market);
				trade.setStock(stock);
				return builder;
		}
}
```

ì„¸ ê°€ì§€ DSL íŒ¨í„´ì„ í˜¼ìš©í•´ ê°€ë…ì„± ìˆëŠ” DSLì„ ë§Œë“œëŠ” ë°©ë²•ì´ ìˆë‹¤.

ì—¬ëŸ¬ íŒ¨í„´ì˜ ì¥ì ì„ í™œìš©í•  ìˆ˜ ìˆì§€ë§Œ ì—¬ëŸ¬ ê°€ì§€ ê¸°ë²•ì„ í˜¼ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ìê°€ DSLì„ ë°°ìš°ëŠ”ë° ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ê²Œ ëœë‹¤.

### 10.3.5 DLSì— ë©”ì„œë“œ ì°¸ì¡° ì‚¬ìš©í•˜ê¸°

```java
public class TaxCalculator {
		private boolean useRegional;
		private boolean useGeneral;
		private boolean useSurcharge;

		public TaxCalculator withTaxRegional() {
				useRegoinal = true;
				return this;
		}

		public TaxCalculator withTaxGeneral() {
				useGeneral = true;
				return this;
		}

		public TaxCalculator withTaxSurcharge() {
				useSurcharge = true;
				return this;
		}

		public double calculate(Order order) {
				return calculate(order, useRegional, useGeneral, useSurcharge);
		}
}
```

```java
double value = new TaxCalculator().withTaxRegional()
																	.withTaxSurcharge()
																	.calculate(order)
```

TaxCalculator ëŠ” ì§€ì—­ ì„¸ê¸ˆê³¼ ì¶”ê°€ ìš”ê¸ˆì„ ì£¼ë¬¸ì— ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ëŠ” ì ì„ ëª…í™•í•˜ê²Œ ë³´ì—¬ì£¼ì§€ë§Œ

ì½”ë“œê°€ ì¥í™©í•˜ë‹¤ëŠ” ê²ƒì´ ë¬¸ì œì´ë‹¤.

ìë°”ì˜ í•¨ìˆ˜í˜• ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ ë” ê°„ê²°í•˜ê³  ìœ ì—°í•œ ë°©ì‹ìœ¼ë¡œ ê°€ë…ì„±ì„ ë‹¬ì„±í•  ìˆ˜ ìˆë‹¤.

```java
public class TaxCalculator {
		public DoubleUnaryOperator taxFunction = d -> d;

		public TaxCalculator with(DoubleUnaryOperator f) {
				taxFunction = taxFunction.andThen(f);
				return this;
		}

		public double calculate(Order order) {
				return taxFunction.applyAsDouble(order.getValue());
		}
}
```

```java
double value = new TaxCalculator().with(Tax::regional)
																	.with(Tax::surcharge)
																	.calculate(order);
```

ì´ ê¸°ë²•ì€ ì£¼ë¬¸ì˜ ì´ í•©ì— ì ìš©í•  í•¨ìˆ˜ í•œ ê°œì˜ í•„ë“œë§Œ í•„ìš”ë¡œí•˜ë©°, TaxCalculator í´ë˜ìŠ¤ë¥¼ í†µí•´ ëª¨ë“  ì„¸ê¸ˆ ì„¤ì •ì´ ì ìš©ëœë‹¤.

# 10.4 ì‹¤ìƒí™œì˜ ìë°” 8 DSL

### 10.4.1 jOOQ

SQLì„ êµ¬í˜„í•˜ëŠ” ë‚´ë¶€ì  DSLë¡œ ìë°”ì— ì§ì ‘ ë‚´ì¥ëœ í˜•ì‹ ì•ˆì • ì–¸ì–´ì´ë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ì—­ê³µí•™í•˜ëŠ” ì†ŒìŠ¤ì½”ë“œ ìƒì„±ê¸° ë•ë¶„ì— ìë°” ì»´íŒŒì¼ëŸ¬ê°€ ë³µì¡í•œ SQL êµ¬ë¬¸ì˜ í˜•ì‹ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```java
create.selectFrom(BOOK)
			.where(BOOK.PUBLISHED_IN.eq(2016))
			.orderBy(BOOK.TITLE)
```

ìŠ¤íŠ¸ë¦¼ APIì™€ ì¡°í•©í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ë˜ë‹¤ë¥¸ ì¥ì ì´ë‹¤.

### 10.4.2 íì»´ë²„

BDD(ë™ì‘ ì£¼ë„ ê°œë°œ)ëŠ” í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œì˜ í™•ì¥ìœ¼ë¡œ ë‹¤ì–‘í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ ì„œìˆ í•˜ëŠ” ê°„ë‹¨í•œ ë„ë©”ì¸ ì „ìš© ìŠ¤í¬ë¦½íŒ… ì–¸ì–´ë¥¼ ì‚¬ìš©í•œë‹¤.

íì»´ë²„ ìŠ¤í¬ë¦½íŒ… ì–¸ì–´ë¡œ ê°„ë‹¨í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```java
Feature: Buy stock
	Senario: Buy 10 IBM stocks
		Given the price of a "IBM" stock is 125$
		When I buy 10 "IBM"
		Then the order value should be 1250$
```

ì „ì œì¡°ê±´ ì •ì˜ Given

ì‹œí—˜í•˜ë ¤ëŠ” ë„ë©”ì¸ ê°ì²´ì˜ ì‹¤ì§ˆ í˜¸ì¶œ When

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ëŠ” Assertion Then

ì„¸ ê°€ì§€ë¡œ êµ¬ë¶„ë˜ëŠ” ê°œë…ì„ ì‚¬ìš©í•œë‹¤.

```java
public class BuyStocksSteps {
	private Map<String, Integer> stockUnitPrices = new HashMap<>();
	private Order order = new Order();

	@Given("^the price of a \"(.*?)\" stock is (\\d+\\$$")
	public void setUnitPrice(String stockName, int unitPrice) {
		stockUnitValues.put(stockName, unitPrice);
	}

	@When("\I buy (\\d+) \"(.*?)\"$")
	public void buyStocks(int quantity, String stockName) {
		...
	}

	@Then("^the Order value should be (\\d+)\\$$")
	public void checkOrderValue(int expectedValue) {
		assertEqulas(expectedValue, order.getValue());
	}
}
```

ìë°” 8ì´ ëŒë‹¤ í‘œí˜„ì‹ì„ ì§€ì›í•˜ë©´ì„œ ë‘ ê°œì˜ ì¸ìˆ˜ ë©”ì„œë“œë¥¼ ì´ìš©í•´ ì–´ë…¸í…Œì´ì…˜ì„ ì œê±°í•˜ëŠ” ë‹¤ë¥¸ ë¬¸ë²•ì„ ê°œë°œí•  ìˆ˜ë„ ìˆë‹¤.

```java
public class BuyStocksSteps {
	private Map<String, Integer> stockUnitPrices = new HashMap<>();
	private Order order = new Order();

	public BuyStocksSteps() {
		Given("^the price of a \"(.*?)\" stock is (\\d+\\$$",
			(String stockName, int unitPrice) -> {
				stockUnitValues.put(stockName, unitPrice);
			});
		...
	}
```

í…ŒìŠ¤íŠ¸ ë©”ì„œë“œê°€ ë¬´ëª… ëŒë‹¤ë¡œ ë°”ë€Œë©´ì„œ ì˜ë¯¸ë¥¼ ê°€ì§„ ë©”ì„œë“œ ì´ë¦„ì„ ì°¾ëŠ” ë¶€ë‹´ì´ ì—†ì–´ì¡Œë‹¤.

### 10.4.3 ìŠ¤í”„ë§ í†µí•©

ìœ ëª…í•œ ì—”í„°í”„ë¼ì´ì¦ˆ í†µí•© íŒ¨í„´ì„ ì§€ì›í•  ìˆ˜ ìˆë„ë¡ ì˜ì¡´ì„± ì£¼ì…ì— ê¸°ë°˜í•œ ìŠ¤í”„ë§ í”„ë¡œê·¸ë˜ë° ëª¨ë¸ì„ í™•ì¥í•œë‹¤.

ìŠ¤í”„ë§ ê¸°ë°˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì˜ ê²½ëŸ‰ì˜ ì›ê²©, ë©”ì„¸ì§•, ìŠ¤ì¼€ì¥´ë§ì„ ì§€ì›í•˜ê³  ì±„ë„, ì—”ë“œí¬ì¸íŠ¸, í´ëŸ¬, ì±„ë„ ì¸í„°ì…‰í„° ë“± ë©”ì„¸ì§€ ê¸°ë°˜ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í•„ìš”í•œ ê°€ì¥ ê³µí†µì˜ íŒ¨í„´ì„ ëª¨ë‘ êµ¬í˜„í•œë‹¤.

```java
@Configuration
@EnableIntegration
public class MyConfiguration {
	@Bean
	public MessageSource<?> integerMessageSource() {
		MethodInvokingMessageSource source = new MethodInvokingMessageSource();
		source.setObject(new AtomicInteger());
		source.setMethodName("getAndIncrement");
		return source;
	}

	@Bean
	public DirectChannel inputChannel() {
		return new DirectChannel();
	}

	@Bean
	public IntegrationFlow myFlow() {
		return IntegrationFlows
				.from(this.integerMessageSource(), c -> c.poller(Pollers.fixedRate(10)))
				.channel(this.inputChannel())
				.filter((Integer p) -> p % 2 == 0)
				.transform(Object::toString)
				.channel(MessageChannels.queue("queueChannel"))
				.get();
	}
}
```

ë©”ì„œë“œ ì²´ì¸ íŒ¨í„´ì„ êµ¬í˜„í•˜ëŠ” IntegrationFlows í´ë˜ìŠ¤ê°€ ì œê³µí•˜ëŠ” ìœ ì—°í•œ ë¹Œë”ë¥¼ ì‚¬ìš©í•œë‹¤.

í”Œë¡œìš°ëŠ” ê³ ì • ì†ë„ë¡œ MessageSource ë¥¼ í´ë§í•˜ë©´ì„œ ì¼ë ¨ì˜ ì •ìˆ˜ë¥¼ ì œê³µí•˜ê³ , í™€ìˆ˜ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•´ ìµœì¢…ì ìœ¼ë¡œ ê²°ê³¼ë¥¼ ì¶œë ¥ ì±„ë„ì— ì „ë‹¬í•œë‹¤.
