---
title: "ğŸ¦Š chap11. null ëŒ€ì‹  Optional í´ë˜ìŠ¤"
author: gengminy
date: 2023-12-22 18:40:00 +09:00
categories: [ëª¨ë˜ ìë°” ì¸ ì•¡ì…˜, "chap11. null ëŒ€ì‹  Optional í´ë˜ìŠ¤"]
tags: [ëª¨ë˜ ìë°” ì¸ ì•¡ì…˜, JAVA, 10ì£¼ì°¨, ë…¸ê²½ë¯¼]
render_with_liquid: false
math: true
---

# chap11. null ëŒ€ì‹  Optioanl í´ë˜ìŠ¤

# 11.1 ê°’ì´ ì—†ëŠ” ìƒí™©ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ê¹Œ?

### 11.1.1 ë³´ìˆ˜ì ì¸ ìì„¸ë¡œ NullPointerException ì¤„ì´ê¸°

- ê¹Šì€ ì˜ì‹¬

```java
public String getCarInsuranceName(Person person) {
		if (person != null) {
				Car car = person.getCar();
				if (car != null) {
						Insurance insurance = car.getInsurancee();
						if (insurance != null) {
								return insurance.getName();
						}
				}
		}
		return "Unknown";
}
```

null í™•ì¸ ì½”ë“œ ë•Œë¬¸ì— ë‚˜ë¨¸ì§€ í˜¸ì¶œ ì²´ì¸ì˜ ë“¤ì—¬ì“°ê¸° ìˆ˜ì¤€ì´ ì¦ê°€í•œë‹¤.

- ë„ˆë¬´ ë§ì€ ì¶œêµ¬

```java
public String getCarInsuranceName(Person person) {
		if (person == null) {
				return "Unknown";
		}
		Car car = person.getCar();
		if (car == null) {
				return "Unknown";
		}
		Insurance insurance = car.getInsurance();
		if (insurance == null) {
				return "Unknown";
		}
		return insurance.getName();
}
```

ë°˜ë³µ íŒ¨í„´ ì½”ë“œë¡œ ì½”ë“œì˜ êµ¬ì¡°ê°€ ì—‰ë§ì´ ë˜ê³  ê°€ë…ì„±ë„ ë–¨ì–´ì§„ë‹¤

### 11.1.2 null ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ë¬¸ì œ

- ì—ëŸ¬ì˜ ê·¼ì›
- ì½”ë“œë¥¼ ì–´ì§€ëŸ½íŒë‹¤
- ì•„ë¬´ ì˜ë¯¸ê°€ ì—†ë‹¤
- ìë°” ì² í•™ì— ìœ„ë°°ëœë‹¤
- í˜•ì‹ ì‹œìŠ¤í…œì— êµ¬ë©ì„ ë§Œë“ ë‹¤

### 11.1.3 ë‹¤ë¥¸ ì–¸ì–´ëŠ” null ëŒ€ì‹ ì— ë¬´ì–¼ ì‚¬ìš©í•˜ë‚˜?

- ì•ˆì „ ë‚´ë¹„ê²Œì´ì…˜ ì—°ì‚°ì (?.)

```java
def carInsuranceName = parson?.car?.insurance?.name
```

- Maybe
- Option[T]

# 11.2 Optional í´ë˜ìŠ¤ ì†Œê°œ

ìë°” 8ì€ í•˜ìŠ¤ì¼ˆê³¼ ìŠ¤ì¹¼ë¼ì˜ ì˜í–¥ì„ ë°›ì•„ java.util.Optional<T> ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì œê³µí•œë‹¤.

ì´ëŠ” ì„ íƒí˜• ê°’ì„ ìº¡ìŠí™”í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.

null ì€ ì°¸ì¡°í•˜ë ¤ í•˜ë©´ NPE ê°€ ë°œìƒí•˜ì§€ë§Œ Optional.empty() ëŠ” ê°ì²´ì´ë¯€ë¡œ ë‹¤ì–‘í•˜ê²Œ í• ìš©í•  ìˆ˜ ìˆë‹¤

ë˜í•œ null ëŒ€ì‹  Optional ì„ ì‚¬ìš©í•˜ë©´ì„œ í˜•ì‹ì´ Optional<T> ë¡œ ë°”ë€ŒëŠ”ë°

ì´ëŠ” ê°’ì´ ì—†ì„ ìˆ˜ ìˆìŒì„ ëª…ì‹œì ìœ¼ë¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤

# 11.3 Optional ì ìš© íŒ¨í„´

### 11.3.1 Optional ê°ì²´ ë§Œë“¤ê¸°

- ë¹ˆ Optional

```java
Optional<Car> optCar = Optional.empty();
```

- nullì´ ì•„ë‹Œ ê°’ìœ¼ë¡œ Optional ë§Œë“¤ê¸°

```java
Optional<Car> optCar = Optional.of(car);
```

- nullê°’ìœ¼ë¡œ Optional ë§Œë“¤ê¸°

```java
Optional<Car> optCar = Optional.ofNullable(car);
```

### 11.3.2 ë§µìœ¼ë¡œ Optionalì˜ ê°’ì„ ì¶”ì¶œí•˜ê³  ë³€í™˜í•˜ê¸°

Optional ì˜ map ë©”ì„œë“œëŠ” ìŠ¤íŠ¸ë¦¼ì˜ map ë©”ì„œë“œì™€ ë¹„ìŠ·í•˜ë‹¤

Optional ê°ì²´ë¥¼ ìµœëŒ€ ìš”ì†Œì˜ ê°œìˆ˜ê°€ í•œ ê°œ ì´í•˜ì¸ ë°ì´í„° ì»¬ë ‰ì…˜ìœ¼ë¡œ ìƒê°í•˜ê³ 

ê°’ì„ í¬í•¨í•˜ë©´ map ì˜ ì¸ìˆ˜ë¡œ ì œê³µëœ í•¨ìˆ˜ê°€ ê°’ì„ ë°”ê¾¼ë‹¤

```java
Optional<Insurance> optInsurance = Optional.ofNullable(insurance);
Optional<String> name = optInsurance.map(Insurance::getName);
```

### 11.3.3 flatMap ìœ¼ë¡œ Optional ê°ì²´ ì—°ê²°

ì´ì°¨ì› Optional ì„ flatMap ìœ¼ë¡œ ì¼ì°¨ì› Optional ë¡œ ì—°ê²°í•  ìˆ˜ ìˆë‹¤

- Optional ë¡œ ìë™ì°¨ì˜ ë³´í—˜íšŒì‚¬ ì´ë¦„ ì°¾ê¸°

```java
public String getCarInsuranceName(Optional<Person> person) {
	return person.flatMap(Person::getCar)
							.flatMap(Car::Insurance)
							.map(Insurance::getName)
							.orElse("Unknown");
}
```

null ì„ í™•ì¸í•˜ëŠë¼ ì¡°ê±´ ë¶„ê¸°ë¬¸ì„ ì¶”ê°€í•´ì„œ ì½”ë“œë¥¼ ë³µì¡í•˜ê²Œ ë§Œë“¤ì§€ ì•Šìœ¼ë©´ì„œë„ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ì™„ì„±í–ˆë‹¤.

ë˜ ë„ë©”ì¸ ëª¨ë¸ê³¼ ê´€ë ¨í•œ ì•”ë¬µì ì¸ ì§€ì‹ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ëª…ì‹œì ìœ¼ë¡œ í˜•ì‹ ì‹œìŠ¤í…œì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

### 11.3.4 Optional ìŠ¤íŠ¸ë¦¼ ì¡°ì‘

ìë°” 9ì—ì„œëŠ” Optional ì— stream() ë©”ì„œë“œë¥¼ ì¶”ê°€í–ˆë‹¤.

```java
public Set<String> getCarInsuranceNames(List<Person> persons) {
		return persons.stream()
									.map(Person::getCar)
									.map(optCar -> optCar.flatMap(Car::getInsurance))
									.map(optIns -> optIns.map(Insurance::getName))
									.flatMap(Optional::stream)
									.collect(toSet());
}
```

Optional ë•ë¶„ì— ì—¬ëŸ¬ ì—°ì‚°ì„ null ê±±ì • ì—†ì´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ ë§ˆì§€ë§‰ ê²°ê³¼ë¥¼ ì–»ê¸° ìœ„í•´ ë¹ˆ Optional ì„ ì œê±°í•˜ê³  ê°’ì„ ì–¸ë©í•´ì•¼ í•œë‹¤.

```java
Stream<Optional<String>> stream =
Set<String> result = stream.filter(Optional::isPresent)
													 .map(Optional::get)
													 .collect(toSet());
```

filter ì™€ map ì„ ì´ìš©í•´ 0ê°œ ì´ìƒì˜ í•­ëª©ì„ í¬í•¨í•˜ëŠ” ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ê°’ì„ í¬í•¨í•˜ëŠ” Optional ì„ ì–¸ë©í•˜ê³  ë¹„ì–´ìˆëŠ” Optional ì€ ê±´ë„ˆë›¸ ìˆ˜ ìˆë‹¤

### 11.3.5 ë””í´íŠ¸ ì•¡ì…˜ê³¼ Optional ì–¸ë©

- get() : ë˜í•‘ëœ ê°’ì´ ì—†ìœ¼ë©´ NoSuchElementException ì„ ë°œìƒì‹œí‚¤ê¸° ë•Œë¬¸ì— ê°€ì¥ ì•ˆì „í•˜ì§€ ì•Šê³  ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.
- orElse: ê°’ì„ í¬í•¨í•˜ì§€ ì•Šì„ ë•Œ ê¸°ë³¸ê°’ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.
- orElseGet(Supplier<? extends T> other) : Optional ì— ê°’ì´ ì—†ì„ ë•Œë§Œ Supplier ê°€ ì‹¤í–‰ëœë‹¤.
- orElseThrow(Supplier<? extends X> exceptionSupplier) : Optional ì´ ë¹„ì–´ìˆì„ ë•Œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
- ifPresent(Consumer<? super T> consumer : ê°’ì´ ì¡´ì¬í•  ë•Œ ì¸ìˆ˜ë¡œ ë„˜ê²¨ì¤€ ë™ì‘ì„ ì‹¤í–‰í•œë‹¤

ìë°” 9ì—ì„œëŠ” ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œê°€ ì¶”ê°€ë˜ì—ˆë‹¤.

- ifPresentOrElse(Consumer<? super T> action, Runnable emptyAction) : Optional ì´ ë¹„ì–´ìˆì„ ë•Œ Runnableì„ ì¸ìˆ˜ë¡œ ë°›ì•„ ì‹¤í–‰í•œë‹¤.

### 11.3.6 ë‘ Optional í•©ì¹˜ê¸°

```java
public Optional<Insurance> nullSafeFindCheapestInsurance(
				Optional<Person> person, Optional<Car> car) {
		return person.flatMap(p -> car.map(c -> findCheapestInsurance(p, c));
}
```

### 11.3.7 í•„í„°ë¡œ íŠ¹ì •ê°’ ê±°ë¥´ê¸°

```java
Optional<Insurance> optInsurance = ...;
optInsurance.filter(insurance ->
										"CambridgeInsurance".equals(insurance.getName())
						.ifPresent(x -> System.out.println("ok"));
```

# 11.4 Optional ì„ ì‚¬ìš©í•œ ì‹¤ìš© ì˜ˆì œ

### 11.4.1 ì ì¬ì ìœ¼ë¡œ nullì´ ë  ìˆ˜ ìˆëŠ” ëŒ€ìƒì„ Optionalë¡œ ê°ì‹¸ê¸°

```java
Optional<Object> value = Optional.ofNullable(map.get("key"));
```

### 11.4.2 ì˜ˆì™¸ì™€ Optional í´ë˜ìŠ¤

Integer.parseInt(String) ì€ ë¬¸ìì—´ì„ ì •ìˆ˜ë¡œ ë°”ê¾¸ì§€ ëª»í•  ë•Œ NumberFormatException ì„ ë°œìƒì‹œí‚¨ë‹¤.

ì´ë¥¼ ë¹ˆ Optional ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```java
public static Optional<Integer> stringToInt(String s) {
		try {
				return Optional.of(Integer.parseInt(s));
		} catch (NumberFormatException e) {
				return Optional.empty();
		}
}
```

### 11.4.3 ê¸°ë³¸í˜• Optionalì„ ì‚¬ìš©í•˜ì§€ ë§ì•„ì•¼ í•˜ëŠ” ì´ìœ 

OptionalInt, OptionalLong, OptionalDouble ë“±ì˜ í´ë˜ìŠ¤ë¥¼ ì œê³µí•œë‹¤.

Stream ê³¼ëŠ” ë‹¤ë¥´ê²Œ Optional ì˜ ìµœëŒ€ ìš”ì†ŒëŠ” 1ê°œì´ë¯€ë¡œ ê¸°ë³¸í˜• íŠ¹í™” í´ë˜ìŠ¤ë¡œ ì„±ëŠ¥ì„ ê°œì„ í•  ìˆ˜ëŠ” ì—†ë‹¤
